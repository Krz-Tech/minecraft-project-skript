# krz-combat - 独自戦闘システム

Tech::Playground の戦闘フレームワークを提供するモジュールです。

## 機能

- **EN (エネルギー)**: 消費・回復管理
- **スタッガー**: 衝撃蓄積と体勢崩し
- **FCS (スマートエイム)**: ロックオン・視点追従システム
- **アサルトダッシュ**: EN消費の高速機動

## ファイル構成

| ファイル | 説明 |
|---------|------|
| `energy.sk` | EN管理（消費・回復） |
| `stagger.sk` | スタッガーシステム |
| `fcs.sk` | FCSコア（ロックオン検出） |
| `fcs-display.sk` | FCS視覚表示（パーティクル） |
| `fcs-view.sk` | FCS視点追従 |
| `fcs-assist.sk` | 弾道補正・近接踏み込み |
| `dash.sk` | アサルトダッシュ |

## デバッグコマンド

| コマンド | 説明 |
|---------|------|
| `/en` | EN残量を表示 |
| `/stagger` | スタッガー蓄積値を表示 |
| `/fcs` | FCSターゲット情報を表示 |
| `/fcs stats` | FCS性能パラメータ |
| `/fcs scan` | 周囲エンティティのスキャン |
| `/fcs toggle` | スマートエイムON/OFF |
| `/fcs init` | FCS再初期化 |
| `/dash` | ダッシュ状態を表示 |

## FCS仕様

### ロックオン
- **レティクル角度**: 装備で変動 (デフォルト15°)
- **ロック距離**: 装備で変動 (デフォルト32m)
- **ロック速度**: 装備で変動 (デフォルト10)

### 視点追従
- ロック完了後、ターゲットへ視点が滑らかに追従
- 45°以上視線を外すとロック解除

### アシスト機能
- **弾道補正**: 投射物がターゲット方向へ緩やかにカーブ
- **近接踏み込み**: 2-5m範囲でターゲットへブースト

## 変数

| 変数 | 説明 |
|-----|------|
| `{-kp::%uuid%::en::current}` | 現在EN |
| `{-kp::%uuid%::en::max}` | 最大EN |
| `{-kp::%uuid%::stagger::current}` | スタッガー蓄積値 |
| `{-kp::%uuid%::stagger::max}` | スタッガー閾値 |
| `{-kp::%uuid%::stagger::active}` | スタッガー状態 |
| `{-kp::%uuid%::fcs::target}` | ロックオン対象 |
| `{-kp::%uuid%::fcs::locked}` | ロック完了フラグ |
| `{-kp::%uuid%::fcs::smart_aim}` | スマートエイム有効 |
| `{-kp::%uuid%::fcs::max_distance}` | ロック距離 |
| `{-kp::%uuid%::fcs::lock_speed}` | ロック速度 |
| `{-kp::%uuid%::fcs::reticle_angle}` | レティクル角度 |
| `{-kp::%uuid%::fcs::aim_strength}` | 視点追従強度 |
| `{-kp::%uuid%::dash::active}` | ダッシュ状態 |
